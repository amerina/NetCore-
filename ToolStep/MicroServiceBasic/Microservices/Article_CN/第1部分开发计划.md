[TOC]

### 如何构建.NET Core微服务

### 教程第1部分:开发计划

我从一开始就喜欢.NET技术。事实上，我在2004年左右离开了过度XML化J2EE开发的黑暗之星，加入了反抗的队伍。多年来，我在Altkom软件咨询公司的团队为保险和银行建立并维护了越来越复杂的业务解决方案。当Java停滞不前时，. NET平台发展迅速。一些开源库被创建并被广泛采用，例如NHibernate、Castle Project或log4net。有了ASP.NET MVC情况就更好了。但在2014年左右，随着微软将大量资源转为开发.NET Core，情况发生了变化。这个想法看起来很棒——让.NET在所有主要平台上运行。但它花了很多年才实现，第一个版本有点令人失望。如此多的API缺失导致许多我们最喜欢的库没有被移植。第一个版本的Entity Framework缺乏关键的特性。. NET的未来似乎令人怀疑。与此同时，Java 8的出现为这门语言带来了清爽的感觉，同时也出现了基于微服务的架构方法。这和[Spring Boot](https://spring.io/projects/spring-boot)一起说服了我重回Java的怀抱。

但是最近的.NET版本——尤其是.NET Core 2.x和.NET Standard的创想使我相信.NET Core又回到了商业领域。因此，我和我的团队决定探索在.NET Core上构建基于微服务的解决方案的可能性和挑战。

自2015年以来，我们在这种架构方法中开发和部署系统，在微服务领域拥有丰富的经验。我们希望找到处理典型微服务相关任务的可能选项，如服务发现、服务同步和异步通信、对各种数据源(关系数据库和noSQL)的数据访问、日志记录、弹性、错误处理、JWT安全检查和API网关构建。

### 计划

在本系列文章中，我们将介绍构建基于微服务的解决方案所需的典型任务。

这些任务包括:

- 微服务的内部架构设计
  - CQRS
  - 事件溯源
- 访问数据源
  - PostgreSQL使用Entity Framework Core
  - NHibernate
  - PostgreSQL使用Marten 
  - ElasticSearch使用NEST 
- 微服务之间的通信
  - 直接HTTP REST同步调用
  - 异步使用RabbitMQ
- 基于Ocelot的API网关
- 使用Eureka发现服务
- 使用Polly弹性处理
- 使用Serilog进行日志记录
- 使用JWT确保服务安全
- 使用Hangfire运行后台作业
- 使用ELK进行日志聚合
- 指标和监控
- Azure DevOps的CI/CD
- 将服务部署到
  - Azure
  - Kubernetes